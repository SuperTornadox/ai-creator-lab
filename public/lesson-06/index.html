<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson 6: Final Project — Plan, Build, Present! - AI Creator Lab</title>
  <link rel="stylesheet" href="/shared/styles.css">
  <style>
    /* ===== Section Dividers ===== */
    .lesson-section {
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-xl);
      border-bottom: 1px solid var(--color-border);
    }

    .lesson-section:last-child {
      border-bottom: none;
    }

    .section-heading {
      font-size: var(--text-xl);
      font-weight: 650;
      margin-bottom: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    /* ===== Project Type Cards ===== */
    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--space-md);
    }

    .project-card {
      background: var(--color-surface);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      padding: var(--space-lg);
      border: 2px solid var(--color-border);
      text-align: center;
      cursor: pointer;
      transition: box-shadow var(--transition-normal),
                  transform var(--transition-normal),
                  border-color var(--transition-normal);
    }

    .project-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .project-card.card-selected {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px var(--color-primary-light);
    }

    .project-card .project-emoji {
      font-size: 2.5rem;
      margin-bottom: var(--space-sm);
    }

    .project-card .project-name {
      font-size: var(--text-lg);
      font-weight: 650;
      margin-bottom: var(--space-xs);
    }

    .project-card .project-desc {
      font-size: var(--text-sm);
      color: var(--color-text-muted);
    }

    /* ===== Planning Form ===== */
    .plan-form {
      background: var(--color-surface);
      border: 1.5px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-top: var(--space-lg);
    }

    .plan-form h3 {
      margin-bottom: var(--space-md);
    }

    .plan-form .form-group {
      margin-bottom: var(--space-md);
    }

    .plan-form label {
      display: block;
      font-size: var(--text-sm);
      font-weight: 600;
      margin-bottom: var(--space-xs);
    }

    .plan-form .tool-checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      margin-top: var(--space-xs);
    }

    .plan-form .tool-checkboxes label {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-weight: 500;
      cursor: pointer;
    }

    .plan-form .tool-checkboxes input[type="checkbox"] {
      accent-color: var(--color-primary);
      width: 18px;
      height: 18px;
    }

    .plan-saved-msg {
      display: none;
      color: var(--color-success);
      font-size: var(--text-sm);
      font-weight: 600;
      margin-top: var(--space-sm);
    }

    /* ===== Build Tabs ===== */
    .build-tabs {
      display: flex;
      gap: var(--space-xs);
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 2px solid var(--color-border);
      flex-wrap: wrap;
    }

    .build-tab-btn {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: 0.5em 1.2em;
      font-size: var(--text-sm);
      font-weight: 600;
      font-family: inherit;
      border: 2px solid var(--color-border);
      background: var(--color-surface);
      color: var(--color-text-muted);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    .build-tab-btn:hover {
      border-color: var(--color-primary);
      color: var(--color-text);
    }

    .build-tab-btn.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: #ffffff;
    }

    .build-panel {
      display: none;
    }

    .build-panel.active {
      display: block;
    }

    /* ===== Project Notes ===== */
    .project-notes-area {
      margin-top: var(--space-lg);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--color-border);
    }

    .project-notes-area label {
      display: block;
      font-size: var(--text-sm);
      font-weight: 600;
      margin-bottom: var(--space-xs);
    }

    .notes-saved-msg {
      display: none;
      color: var(--color-success);
      font-size: var(--text-xs);
      font-weight: 600;
      margin-top: var(--space-xs);
    }

    /* ===== Presentation Prep ===== */
    .present-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }

    .present-form label {
      display: block;
      font-size: var(--text-sm);
      font-weight: 600;
      margin-bottom: var(--space-xs);
    }

    .present-actions {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
      align-items: center;
      margin-top: var(--space-md);
    }

    /* ===== Presentation Mode Overlay ===== */
    .presentation-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 99999;
      background: linear-gradient(160deg, #1e2330 0%, #2d1b69 50%, #1e2330 100%);
      color: #ffffff;
      overflow-y: auto;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .presentation-overlay.visible {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 60px 40px;
    }

    .presentation-close {
      position: fixed;
      top: 20px;
      right: 24px;
      background: rgba(255,255,255,0.15);
      border: none;
      color: #ffffff;
      font-size: 1.5rem;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
      z-index: 100000;
    }

    .presentation-close:hover {
      background: rgba(255,255,255,0.3);
    }

    .presentation-content {
      max-width: 800px;
      width: 100%;
      text-align: center;
    }

    .presentation-content h1 {
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 0.3em;
      background: linear-gradient(135deg, #a78bfa, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .presentation-content .pres-author {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 2em;
    }

    .presentation-content .pres-section {
      text-align: left;
      margin-bottom: 2em;
    }

    .presentation-content .pres-section h2 {
      font-size: 1.4rem;
      font-weight: 700;
      color: #a78bfa;
      margin-bottom: 0.5em;
    }

    .presentation-content .pres-section p {
      font-size: 1.15rem;
      line-height: 1.8;
      color: rgba(255,255,255,0.85);
      white-space: pre-wrap;
    }

    /* ===== Graduation Section ===== */
    .graduation-section {
      background: linear-gradient(135deg, #4f6ef7 0%, #7c3aed 40%, #ec4899 70%, #f59e0b 100%);
      border-radius: var(--radius-lg);
      padding: var(--space-xl) var(--space-xl) var(--space-xl);
      color: #ffffff;
      text-align: center;
    }

    .graduation-section h2 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: var(--space-xs);
    }

    .graduation-section .grad-subtitle {
      font-size: var(--text-lg);
      opacity: 0.9;
      margin-bottom: var(--space-lg);
    }

    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .skill-badge {
      background: rgba(255,255,255,0.18);
      backdrop-filter: blur(6px);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      text-align: center;
    }

    .skill-badge .skill-emoji {
      font-size: 2rem;
      margin-bottom: var(--space-xs);
    }

    .skill-badge .skill-name {
      font-size: var(--text-sm);
      font-weight: 700;
    }

    .skill-badge .skill-lesson {
      font-size: var(--text-xs);
      opacity: 0.75;
    }

    .graduation-message {
      font-size: var(--text-lg);
      line-height: 1.7;
      opacity: 0.95;
      max-width: 600px;
      margin: 0 auto;
    }

    /* ===== Collection Gallery ===== */
    .collection-empty {
      text-align: center;
      padding: var(--space-xl);
      color: var(--color-text-muted);
      font-size: var(--text-sm);
    }
  </style>
</head>
<body>

  <!-- Lesson Header -->
  <header class="lesson-header">
    <div class="lesson-badge">
      <span class="lesson-number">06</span>
      <span class="lesson-title">Final Project</span>
    </div>
    <a href="/" class="back-link">&larr; Back to all lessons</a>
  </header>

  <!-- Page Layout -->
  <div class="lesson-page">

    <!-- Main Content Area -->
    <main class="lesson-main" id="main-content">

      <!-- ===== Section 1: Choose & Plan ===== -->
      <div class="lesson-section">
        <h2 class="section-heading">&#x1F3AF; Choose Your Project</h2>
        <div class="project-grid" id="project-grid">
          <!-- rendered by JS -->
        </div>

        <div class="plan-form" id="plan-form">
          <h3>&#x1F4DD; My Project Plan</h3>
          <div class="form-group">
            <label for="plan-title">Project Title</label>
            <input type="text" class="input" id="plan-title" placeholder="Give your project a cool name...">
          </div>
          <div class="form-group">
            <label for="plan-description">What is your project about?</label>
            <textarea class="textarea" id="plan-description" rows="2" placeholder="Describe your project in 1-2 sentences..."></textarea>
          </div>
          <div class="form-group">
            <label>Tools I'll use</label>
            <div class="tool-checkboxes">
              <label><input type="checkbox" id="tool-text" value="text"> &#x1F4DD; Text AI</label>
              <label><input type="checkbox" id="tool-image" value="image"> &#x1F3A8; Image AI</label>
              <label><input type="checkbox" id="tool-code" value="code"> &#x1F4BB; Code AI</label>
              <label><input type="checkbox" id="tool-music" value="music"> &#x1F3B5; Music (Suno)</label>
            </div>
          </div>
          <div class="form-group">
            <label for="plan-steps">My Plan (3-5 steps)</label>
            <textarea class="textarea" id="plan-steps" rows="5" placeholder="Step 1: ...&#10;Step 2: ...&#10;Step 3: ..."></textarea>
          </div>
          <button class="btn btn-primary" id="save-plan-btn">&#x1F4BE; Save My Plan</button>
          <div class="plan-saved-msg" id="plan-saved-msg">&#x2705; Plan saved!</div>
        </div>
      </div>

      <!-- ===== Section 2: Build ===== -->
      <div class="lesson-section">
        <h2 class="section-heading">&#x1F528; Build Your Project</h2>

        <nav class="build-tabs" id="build-tabs">
          <button class="build-tab-btn active" data-tab="tab-text">&#x1F4DD; Text AI</button>
          <button class="build-tab-btn" data-tab="tab-image">&#x1F3A8; Image AI</button>
          <button class="build-tab-btn" data-tab="tab-code">&#x1F4BB; Code AI</button>
          <button class="build-tab-btn" data-tab="tab-collection">&#x1F5BC;&#xFE0F; My Collection</button>
        </nav>

        <!-- Tab 1: Text AI -->
        <div class="build-panel active" id="tab-text">
          <div id="text-chat"></div>
        </div>

        <!-- Tab 2: Image AI -->
        <div class="build-panel" id="tab-image">
          <div id="image-gen"></div>
        </div>

        <!-- Tab 3: Code AI -->
        <div class="build-panel" id="tab-code">
          <div id="code-playground"></div>
        </div>

        <!-- Tab 4: My Collection -->
        <div class="build-panel" id="tab-collection">
          <div id="my-gallery"></div>
        </div>

        <!-- Project Notes -->
        <div class="project-notes-area">
          <label for="project-notes">&#x1F4D3; Project Notes (auto-saves)</label>
          <textarea class="textarea" id="project-notes" rows="4" placeholder="Keep track of ideas, prompts that worked well, things to try next..."></textarea>
          <div class="notes-saved-msg" id="notes-saved-msg">&#x2705; Saved</div>
        </div>
      </div>

      <!-- ===== Section 3: Present ===== -->
      <div class="lesson-section">
        <h2 class="section-heading">&#x1F3A4; Prepare Your Presentation</h2>

        <div class="present-form">
          <div class="form-group">
            <label for="pres-about">About My Project</label>
            <textarea class="textarea" id="pres-about" rows="4" placeholder="Describe your project: What is it? What does it do? Why did you choose this idea?"></textarea>
          </div>
          <div class="form-group">
            <label for="pres-process">My Creative Process</label>
            <textarea class="textarea" id="pres-process" rows="4" placeholder="How did you make it? What tools did you use? What challenges did you face? What did you learn?"></textarea>
          </div>
        </div>

        <div class="present-actions">
          <button class="btn btn-primary" id="launch-presentation-btn">&#x1F680; Launch Presentation Mode</button>
          <div id="export-container"></div>
        </div>
      </div>

      <!-- ===== Section 4: Graduation ===== -->
      <div class="lesson-section">
        <div class="graduation-section">
          <h2>&#x1F393; Congratulations!</h2>
          <p class="grad-subtitle">You're now an AI Creator!</p>

          <div class="skills-grid">
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F4DD;</div>
              <div class="skill-name">Text AI</div>
              <div class="skill-lesson">Lesson 1 & 2</div>
            </div>
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F3A8;</div>
              <div class="skill-name">Image AI</div>
              <div class="skill-lesson">Lesson 3</div>
            </div>
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F3B5;</div>
              <div class="skill-name">Music AI</div>
              <div class="skill-lesson">Lesson 4</div>
            </div>
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F3AC;</div>
              <div class="skill-name">Film Making</div>
              <div class="skill-lesson">Lesson 5</div>
            </div>
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F4BB;</div>
              <div class="skill-name">Code AI</div>
              <div class="skill-lesson">Lesson 6</div>
            </div>
            <div class="skill-badge">
              <div class="skill-emoji">&#x1F9E0;</div>
              <div class="skill-name">AI Ethics</div>
              <div class="skill-lesson">Every Lesson</div>
            </div>
          </div>

          <p class="graduation-message">
            You have learned to use AI as a creative partner &mdash; for writing, art, music, film, and code.
            These skills will only grow as AI keeps evolving. Keep creating, keep experimenting, and never stop being curious.
            The future belongs to creators like YOU!
          </p>
        </div>
      </div>

    </main>

    <!-- Task Sidebar -->
    <aside class="lesson-sidebar">
      <div class="task-sidebar" id="task-sidebar"></div>
    </aside>

  </div>

  <!-- Presentation Mode Overlay -->
  <div class="presentation-overlay" id="presentation-overlay">
    <button class="presentation-close" id="presentation-close">&times;</button>
    <div class="presentation-content" id="presentation-content">
      <!-- filled by JS -->
    </div>
  </div>

  <script src="/shared/components.js"></script>
  <script>
    // =============================================
    // LocalStorage Keys
    // =============================================
    var STORAGE_PREFIX = 'lesson06_';
    function storageKey(name) { return STORAGE_PREFIX + name; }

    function saveToStorage(key, value) {
      try { localStorage.setItem(storageKey(key), JSON.stringify(value)); } catch (e) { /* ignore */ }
    }

    function loadFromStorage(key, fallback) {
      try {
        var v = localStorage.getItem(storageKey(key));
        return v ? JSON.parse(v) : fallback;
      } catch (e) { return fallback; }
    }

    // =============================================
    // Section 1: Choose Your Project
    // =============================================
    var projectTypes = [
      { id: 'magazine', emoji: '\uD83D\uDCF0', name: 'AI Magazine', desc: 'Create articles & illustrations for a magazine' },
      { id: 'film',     emoji: '\uD83C\uDFAC', name: 'AI Short Film', desc: 'Write a story and generate scene images' },
      { id: 'game',     emoji: '\uD83C\uDFAE', name: 'AI Game', desc: 'Design and code a simple game with AI help' },
      { id: 'free',     emoji: '\u2728',        name: 'Free Choice', desc: 'Your own idea! Combine any AI tools' }
    ];

    var projectGrid = document.getElementById('project-grid');
    var selectedProjectType = loadFromStorage('projectType', null);

    projectTypes.forEach(function (proj) {
      var card = document.createElement('div');
      card.className = 'project-card' + (selectedProjectType === proj.id ? ' card-selected' : '');

      var emojiEl = document.createElement('div');
      emojiEl.className = 'project-emoji';
      emojiEl.textContent = proj.emoji;

      var nameEl = document.createElement('div');
      nameEl.className = 'project-name';
      nameEl.textContent = proj.name;

      var descEl = document.createElement('div');
      descEl.className = 'project-desc';
      descEl.textContent = proj.desc;

      card.appendChild(emojiEl);
      card.appendChild(nameEl);
      card.appendChild(descEl);

      card.addEventListener('click', function () {
        var allCards = projectGrid.querySelectorAll('.project-card');
        allCards.forEach(function (c) { c.classList.remove('card-selected'); });
        card.classList.add('card-selected');
        selectedProjectType = proj.id;
        saveToStorage('projectType', proj.id);
        taskCards.setComplete('choose-project', true);
      });

      projectGrid.appendChild(card);
    });

    if (selectedProjectType) {
      taskCards && taskCards.setComplete && taskCards.setComplete('choose-project', true);
    }

    // =============================================
    // Planning Form — Load & Save
    // =============================================
    var planTitle = document.getElementById('plan-title');
    var planDescription = document.getElementById('plan-description');
    var planSteps = document.getElementById('plan-steps');
    var savePlanBtn = document.getElementById('save-plan-btn');
    var planSavedMsg = document.getElementById('plan-saved-msg');
    var toolText = document.getElementById('tool-text');
    var toolImage = document.getElementById('tool-image');
    var toolCode = document.getElementById('tool-code');
    var toolMusic = document.getElementById('tool-music');

    // Load saved plan
    var savedPlan = loadFromStorage('plan', null);
    if (savedPlan) {
      planTitle.value = savedPlan.title || '';
      planDescription.value = savedPlan.description || '';
      planSteps.value = savedPlan.steps || '';
      if (savedPlan.tools) {
        toolText.checked = savedPlan.tools.indexOf('text') !== -1;
        toolImage.checked = savedPlan.tools.indexOf('image') !== -1;
        toolCode.checked = savedPlan.tools.indexOf('code') !== -1;
        toolMusic.checked = savedPlan.tools.indexOf('music') !== -1;
      }
    }

    savePlanBtn.addEventListener('click', function () {
      var tools = [];
      if (toolText.checked) tools.push('text');
      if (toolImage.checked) tools.push('image');
      if (toolCode.checked) tools.push('code');
      if (toolMusic.checked) tools.push('music');

      var plan = {
        title: planTitle.value.trim(),
        description: planDescription.value.trim(),
        steps: planSteps.value.trim(),
        tools: tools
      };
      saveToStorage('plan', plan);

      planSavedMsg.style.display = 'block';
      setTimeout(function () { planSavedMsg.style.display = 'none'; }, 2000);

      if (plan.title && plan.steps) {
        taskCards.setComplete('write-plan', true);
      }
    });

    // =============================================
    // Section 2: Build — Tab Navigation
    // =============================================
    var tabBtns = document.querySelectorAll('.build-tab-btn');
    var tabPanels = document.querySelectorAll('.build-panel');

    tabBtns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var target = btn.getAttribute('data-tab');

        tabBtns.forEach(function (b) { b.classList.remove('active'); });
        btn.classList.add('active');

        tabPanels.forEach(function (p) { p.classList.remove('active'); });
        document.getElementById(target).classList.add('active');
      });
    });

    // =============================================
    // Tab 1: Text AI (ChatWidget)
    // =============================================
    var textChatContainer = document.getElementById('text-chat');

    window.ChatWidget(textChatContainer, {
      systemPrompt: 'You are a creative project advisor for kids aged 12-13. Help them brainstorm, write, and refine creative projects. You can help with: writing articles, stories, scripts, game designs, descriptions, dialogue, and any text content for their AI Creator Lab final project. Be encouraging, fun, and give specific suggestions. Keep responses concise and age-appropriate.',
      placeholder: 'Ask for help with your project... (e.g., "Help me write an article about space for my AI magazine")'
    });

    // =============================================
    // Tab 2: Image AI (ImageGenerator)
    // =============================================
    var imageGenContainer = document.getElementById('image-gen');

    window.ImageGenerator(imageGenContainer, {
      showGallery: true
    });

    // =============================================
    // Tab 3: Code AI (CodePlayground)
    // =============================================
    var codeContainer = document.getElementById('code-playground');

    window.CodePlayground(codeContainer, {
      onRun: function () {
        taskCards.setComplete('build-project', true);
      }
    });

    // =============================================
    // Tab 4: My Collection (Gallery)
    // =============================================
    var galleryContainer = document.getElementById('my-gallery');

    window.Gallery(galleryContainer, {
      columns: 3
    });

    // =============================================
    // Project Notes — Auto-save
    // =============================================
    var projectNotes = document.getElementById('project-notes');
    var notesSavedMsg = document.getElementById('notes-saved-msg');
    var notesSaveTimer = null;

    // Load
    projectNotes.value = loadFromStorage('notes', '') || '';

    projectNotes.addEventListener('input', function () {
      clearTimeout(notesSaveTimer);
      notesSaveTimer = setTimeout(function () {
        saveToStorage('notes', projectNotes.value);
        notesSavedMsg.style.display = 'block';
        setTimeout(function () { notesSavedMsg.style.display = 'none'; }, 1500);
      }, 800);
    });

    // =============================================
    // Section 3: Presentation
    // =============================================
    var presAbout = document.getElementById('pres-about');
    var presProcess = document.getElementById('pres-process');

    // Load saved presentation text
    presAbout.value = loadFromStorage('presAbout', '') || '';
    presProcess.value = loadFromStorage('presProcess', '') || '';

    // Auto-save presentation fields
    presAbout.addEventListener('input', function () {
      saveToStorage('presAbout', presAbout.value);
    });
    presProcess.addEventListener('input', function () {
      saveToStorage('presProcess', presProcess.value);
      if (presAbout.value.trim() && presProcess.value.trim()) {
        taskCards.setComplete('write-presentation', true);
      }
    });

    // Launch Presentation Mode
    var overlay = document.getElementById('presentation-overlay');
    var presContent = document.getElementById('presentation-content');
    var launchBtn = document.getElementById('launch-presentation-btn');
    var closeBtn = document.getElementById('presentation-close');

    launchBtn.addEventListener('click', function () {
      // Build presentation content
      clearChildren(presContent);

      var title = planTitle.value.trim() || 'My Final Project';
      var studentName = '';
      try { studentName = sessionStorage.getItem('studentName') || ''; } catch (e) { /* ignore */ }

      var h1 = document.createElement('h1');
      h1.textContent = title;
      presContent.appendChild(h1);

      if (studentName) {
        var author = document.createElement('p');
        author.className = 'pres-author';
        author.textContent = 'by ' + studentName;
        presContent.appendChild(author);
      }

      var aboutText = presAbout.value.trim();
      if (aboutText) {
        var aboutSection = document.createElement('div');
        aboutSection.className = 'pres-section';
        var aboutH2 = document.createElement('h2');
        aboutH2.textContent = 'About My Project';
        var aboutP = document.createElement('p');
        aboutP.textContent = aboutText;
        aboutSection.appendChild(aboutH2);
        aboutSection.appendChild(aboutP);
        presContent.appendChild(aboutSection);
      }

      var processText = presProcess.value.trim();
      if (processText) {
        var processSection = document.createElement('div');
        processSection.className = 'pres-section';
        var processH2 = document.createElement('h2');
        processH2.textContent = 'My Creative Process';
        var processP = document.createElement('p');
        processP.textContent = processText;
        processSection.appendChild(processH2);
        processSection.appendChild(processP);
        presContent.appendChild(processSection);
      }

      overlay.classList.add('visible');
      taskCards.setComplete('present-celebrate', true);
    });

    closeBtn.addEventListener('click', function () {
      overlay.classList.remove('visible');
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && overlay.classList.contains('visible')) {
        overlay.classList.remove('visible');
      }
    });

    // =============================================
    // Export Button
    // =============================================
    var exportContainer = document.getElementById('export-container');

    window.ExportButton(exportContainer, {
      label: 'Download Presentation',
      filename: 'my-ai-project-presentation.html',
      format: 'html',
      getData: function () {
        var title = planTitle.value.trim() || 'My Final Project';
        var studentName = '';
        try { studentName = sessionStorage.getItem('studentName') || ''; } catch (e) { /* ignore */ }
        var about = presAbout.value.trim();
        var process = presProcess.value.trim();

        var html = [];
        html.push('<!DOCTYPE html>');
        html.push('<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">');
        html.push('<title>' + escapeHtml(title) + '</title>');
        html.push('<style>');
        html.push('*{box-sizing:border-box;margin:0;padding:0}');
        html.push('body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:linear-gradient(160deg,#1e2330,#2d1b69,#1e2330);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:60px 40px}');
        html.push('.card{max-width:700px;width:100%;text-align:center}');
        html.push('h1{font-size:2.8rem;font-weight:800;background:linear-gradient(135deg,#a78bfa,#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.3em}');
        html.push('.author{font-size:1.1rem;color:rgba(255,255,255,.5);margin-bottom:2em}');
        html.push('.section{text-align:left;margin-bottom:2em}');
        html.push('.section h2{font-size:1.3rem;color:#a78bfa;margin-bottom:.4em}');
        html.push('.section p{font-size:1.1rem;line-height:1.8;color:rgba(255,255,255,.85);white-space:pre-wrap}');
        html.push('</style></head><body>');
        html.push('<div class="card">');
        html.push('<h1>' + escapeHtml(title) + '</h1>');
        if (studentName) html.push('<p class="author">by ' + escapeHtml(studentName) + '</p>');
        if (about) html.push('<div class="section"><h2>About My Project</h2><p>' + escapeHtml(about) + '</p></div>');
        if (process) html.push('<div class="section"><h2>My Creative Process</h2><p>' + escapeHtml(process) + '</p></div>');
        html.push('</div></body></html>');
        return html.join('\n');
      }
    });

    // =============================================
    // Task Sidebar
    // =============================================
    var taskSidebar = document.getElementById('task-sidebar');

    var taskCards = window.TaskCards(taskSidebar, [
      { id: 'choose-project',     title: 'Choose your project type',  description: 'Pick: Magazine, Film, Game, or Free Choice' },
      { id: 'write-plan',         title: 'Write your plan',           description: 'Fill in your title, description, and steps' },
      { id: 'build-project',      title: 'Build your project',        description: 'Use Text AI, Image AI, and Code AI to create' },
      { id: 'write-presentation', title: 'Write your presentation',   description: 'Describe your project and creative process' },
      { id: 'present-celebrate',  title: 'Present and celebrate!',    description: 'Launch presentation mode and share your work' }
    ]);

    // Restore completed states
    if (selectedProjectType) taskCards.setComplete('choose-project', true);
    if (savedPlan && savedPlan.title && savedPlan.steps) taskCards.setComplete('write-plan', true);

    // =============================================
    // Utility
    // =============================================
    function clearChildren(el) {
      while (el.firstChild) {
        el.removeChild(el.firstChild);
      }
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }
  </script>

</body>
</html>
